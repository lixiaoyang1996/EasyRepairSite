<div class="content-wrapper">
    <div class="container">
        <div class="box" style="margin-top: 50px">
            <div class="box-header with-border">
                <h3 class="box-title"><font style="vertical-align: inherit;"><font
                        style="vertical-align: inherit;">店铺年订单数回顾</font></font></h3>

                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div id="container" style="max-width:100%;height:335px"
                     typeUrl="{:U('Business/SalesVolume/countType')}">
                </div>
            </div>

            <div class="box box-default">
                <div class="box-header with-border">
                    <h3 class="box-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">店铺每月收入统计</font></font>
                    </h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="box-body">
                    <div id="container1" style="min-width:100%;height: 335px"
                         moneyUrl="{:U('Business/SalesVolume/countMoney')}">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="__COMPONENTS__/Highcharts/highcharts.js"></script>
<script src="__COMPONENTS__/jquery/dist/jquery.min.js"></script>
<script>
    var chartType = Highcharts.chart('container', {
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            events:{
                load:countType
            }
        },
        title: {
            text: '2018 {$s.name}各个订单占比数'
        },
        subtitle: {
            text: '数据来源: 易修网'
        },
        tooltip: {
            headerFormat: '{series.name}<br>',
            pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: false
                },
                showInLegend: true
            }
        },
        series: [{
            type: 'pie',
            name: '顾客订单占比',
            data: []
        }]
    });

    var chartMoney = Highcharts.chart('container1', {
        chart: {
            type: 'column',
            events: {
                load: countMoney
            }
        },
        title: {
            text: '{$s.name}各个月交易额'
        },
        subtitle: {
            text: '数据来源: 易修网'
        },
        xAxis: {
            categories: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: '千元'
            }
        },
        plotOptions: {
            column: {
                borderWidth: 0
            }
        },
        series: [{
            name: '月营业额',
            data: []
        }]
    });

    function countType(url) {
        $.ajax({
            url: $('[typeUrl]').attr("typeUrl"),
            type: 'post',
            dataType: 'json',
            success: function (response) {
                chartType.series[0].setData(response.data[0]);
            }
        });
    }

    function countMoney(url) {
        $.ajax({
            url: $('[moneyUrl]').attr("moneyUrl"),
            type: 'post',
            dataType: 'json',
            success: function (response) {
                chartMoney.series[0].setData(response.data[0]);
                console.log(response.data[0]);
            }
        });
    }
</script>

